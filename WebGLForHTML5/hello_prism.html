<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <style>
        body {
            background-color: #ffffff;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
    <script src="common/three.min.js"></script>
</head>
<body>
<script>
    (function(W){
        var CANVAS_WIDTH = 400, CANVAS_HEIGHT = 300,
                doc = W['document'], angle = 0,
                renderer, scene, camera, mesh;

        function initWebGL(){
            var origin_mesh_x;

            setupRenderer();
            setupScene();
            setupCamera();

            origin_mesh_x = mesh.position.x;

            (function loop(){
                mesh.position.x = origin_mesh_x + 2.0 * Math.cos(angle);
                mesh.rotation.y = angle;

                angle += 0.025;

                renderer.render( scene, camera );
                requestAnimationFrame(loop);
            })();
        }

        function setupRenderer(){
            var canvas = doc.createElement('canvas'), gl;

            ['webgl', 'experimental-webgl', 'webkit-3d', 'moz-webgl'].some(function(c){ return gl = canvas.getContext(c); });

            renderer = ( gl ) ? new THREE.WebGLRenderer() : new THREE.CanvasRenderer();

            renderer.setSize( CANVAS_WIDTH, CANVAS_HEIGHT );
            renderer.setClearColor( 0x007700, 1.0 );
            doc.body.appendChild(renderer.domElement);

            canvas = undefined, gl = undefined;
        }

        function setupScene(){
            scene = new THREE.Scene();
            addMesh();
        }

        function setupCamera(){
            camera = new THREE.PerspectiveCamera( 45, CANVAS_WIDTH / CANVAS_HEIGHT,.1, 10000 );
            camera.position.set( 0, 0, -10 );
            camera.lookAt(scene.position);
            scene.add(camera);
        }

        function addMesh(){
            var vertices = [
                        //front face
                        //bottom left to right,  to top
                        0.0, 0.0, 0.0,
                        1.0, 0.0, 0.0,
                        2.0, 0.0, 0.0,
                        0.5, 1.0, 0.0,
                        1.5, 1.0, 0.0,
                        1.0, 2.0, 0.0,

                        //rear face
                        0.0, 0.0, -2.0,
                        1.0, 0.0, -2.0,
                        2.0, 0.0, -2.0,
                        0.5, 1.0, -2.0,
                        1.5, 1.0, -2.0,
                        1.0, 2.0, -2.0
                    ],
                    verticeColors = [
                        //front face
                        0.0, 0.0, 1.0,
                        1.0, 1.0, 1.0,
                        0.0, 0.0, 1.0,
                        0.0, 0.0, 1.0,
                        0.0, 0.0, 1.0,
                        1.0, 1.0, 1.0,

                        //rear face
                        0.0, 1.0, 1.0,
                        1.0, 1.0, 1.0,
                        0.0, 1.0, 1.0,
                        0.0, 1.0, 1.0,
                        0.0, 1.0, 1.0,
                        1.0, 1.0, 1.0
                    ],
                    vertexIndices = [
                        0,1,3,			//front face
                        1,4,3,	//flipped
                        1,2,4,
                        3,4,5,

                        6,7,9,			//rear face
                        7,10,9,	//flipped
                        7,8,10,
                        9,10,11,

                        0,6,3,//flipped			//left side
                        3,6,9,
                        3,9,5,//flipped
                        5,9,11,

                        2,8,4,//flipped			//right side
                        4,8,10,
                        4,10,5,//flipped
                        5,10,11
                    ],
                    colors = [], i = 0, l = vertexIndices.length, f = 0;

            var geometry = new THREE.Geometry();
            geometry.dynamic = true;

            for( ; i < l; i += 3 ){
                geometry.vertices.push( new THREE.Vector3( vertices[i], vertices[i + 1], vertices[i + 2] ) );
                colors.push( new THREE.Color().setRGB( verticeColors[i], verticeColors[i + 1], verticeColors[i + 2] ) );
            }

            i = 0, l = vertexIndices.length;

            for( ; i < l; i += 3 ){
                geometry.faces.push( new THREE.Face3( vertexIndices[i], vertexIndices[i + 1], vertexIndices[i + 2] ) );
            }

            i = 0, l = vertexIndices.length;

            for( ; i < l; i += 3 ){
                geometry.faces[f].vertexColors.push( colors[vertexIndices[i]] );
                geometry.faces[f].vertexColors.push( colors[vertexIndices[i + 1]] );
                geometry.faces[f].vertexColors.push( colors[vertexIndices[i + 2]] );
                ++f;
            }

            mesh = new THREE.Mesh( geometry,  new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}) );
            mesh.doubleSided = true;

            scene.add(mesh);
        }

        initWebGL();
    })(this);
</script>
</body>
</html>